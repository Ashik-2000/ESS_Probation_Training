<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h4>Sales Orders</h4>
    <a routerLink="/orders/new" class="btn btn-primary">+ New Order</a>
  </div>

  <!-- Filter/Search Bar -->
  <div class="row g-2 mb-3">
    <div class="col-md-4">
      <input
        type="text"
        class="form-control"
        placeholder="Search by customer name..."
        [(ngModel)]="queryParams.search"
        (input)="onSearchChange()"
      />
    </div>
    <div class="col-md-3">
      <select
        class="form-select"
        [(ngModel)]="queryParams.status"
        (change)="onFilterChange()"
      >
        <option value="">All Status</option>
        <option value="Completed">Completed</option>
        <option value="Pending">Pending</option>
        <option value="Cancelled">Cancelled</option>
      </select>
    </div>
    <div class="col-md-3">
      <button class="btn btn-primary" (click)="clearFilters()">
        Clear Filters
      </button>
    </div>
  </div>

  <!-- Order List table -->
  <table class="table table-striped table-hover">
    <thead class="table-dark">
      <tr>
        <th>Order No</th>
        <th>Customer</th>
        <th (click)="onSort('date')" class="sortable">
          Date
          <span *ngIf="queryParams.sortBy === 'date'">
            <i
              class="bi"
              [ngClass]="{
                'bi-caret-up-fill': queryParams.sortDir === 'asc',
                'bi-caret-down-fill': queryParams.sortDir === 'desc'
              }"
            ></i>
          </span>
        </th>
        <th>Total</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let order of orders">
        <td>{{ order.orderNo }}</td>
        <td>{{ order.customer.name }}</td>
        <td>{{ order.date }}</td>
        <td>{{ order.total | currency }}</td>
        <td>
          <span
            class="badge"
            [ngClass]="{
              'bg-success': order.status === 'Completed',
              'bg-warning': order.status === 'Pending',
              'bg-danger': order.status === 'Cancelled'
            }"
          >
            {{ order.status }}
          </span>
        </td>
        <td>
          <a
            [routerLink]="['/orders', order.id, 'edit']"
            class="btn btn-sm btn-outline-primary me-2"
            >Edit</a
          >
          <button
            class="btn btn-sm btn-outline-danger"
            (click)="onDelete(order.id)"
          >
            Delete
          </button>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- Pagination -->
  <div
    class="d-flex justify-content-between align-items-center mt-3"
    *ngIf="totalRecords > queryParams.pageSize!"
  >
    <button
      class="btn btn-outline-success"
      [disabled]="queryParams.page === 1"
      (click)="previousPage()"
    >
      Previous
    </button>
    <span> Page {{ queryParams.page }} </span>
    <button
      class="btn btn-outline-success"
      [disabled]="queryParams.page! * queryParams.pageSize! >= totalRecords"
      (click)="nextPage()"
    >
      Next
    </button>
  </div>
</div>
